import {Migrate} from 'migrations/Migration';
import { CreateUser, User } from "domain/user/User";
import { MakeUserGateway } from "gateway/user/UserGateway";
import {readJSON, resourcePath} from "framework/Util";
const MIGRATION_NAME = "Add_User_Data";
import winston from "framework/Logger";;
const md5 = require("md5");

export function up() {
    return Migrate(MIGRATION_NAME, () => {
        return new Promise((resolve: any, reject: any) => {
            const userData = readJSON(`${resourcePath()}/users.json`);
            resolve(userData.map((data) => {
                const user = MakeUserGateway().create(CreateUser({
                    password: md5(data.password + ""),
                    email: data.email,
                    name: data.name,
                    type: data.type
                }));
                return user;
            }));
        });
    });
}
